# 图书商城开发笔记(后端)

## 分层开发

### 包的命名

* web层：
  com.suftz.web.servlet
* service层：
  com.suftz.service
  com.suftz.service.impl
* dao层：
  com.suftz.dao
  com.suftz.dao.impl
* bean对象：
  com.suftz.bean
* 测试包：
  com.suftz.test.junit
* 工具包
  com.suftz.utils

## 注册登录功能

<pre>
1. 获取请求的参数
2. 检查验证码是否正确
   正确：
      检查用户名是否可用
         可用
            调用Service保存到数据库
            跳转到注册成功页面
         不可用
            跳回注册页面
   不正确:
      跳回注册页面
</pre>


1. 获取请求的参数
2. 调用Service处理业务，进行登录
3. 根据login()方法返回结果判定登录是否成功
   成功
      跳转到login_success.html
   失败
      跳回登录页面

* 分页的功能

* 免用户登录：其实就是登录成功后，使用cookie，把用户名存储到本地浏览器，然后jsp页面中input为用户名的value缺省为${cookie.username.value}

* 处理重复提交，添加验证码的功能，使用谷歌的kaptcha.jar包


doFiter
* 页面的权限检查，需要登录才能访问的页面需要验证是否登录，或者验证不同用户的权限
* 后台管理页面需要权限管理只有管理员用户才能访问

* 事务管理：有些操作需要进行事务管理，让一个请求，使用通一个数据库连接，即baseDao里面的connection使用ThrealLocal取出来的
1. 在拦截器里提交事务或者回滚事务
2. 数据库工具类中，获取连接要在threadlocal中进行，
3. dao层操作数据库要向上抛异常，手写抛运行时异常，这样就不用写throws，然后在事务中，即拦截器里集中trycatch，如果出现没有错误就提交，有则回滚，让一个业务的

* 目前缺少三个工具类：baseServlet  ,请求转发
WebUtils，将request中的参数注入到bean中
beanUtils  apache commons提供的

* 配置错误页面
```xml
<error-page>
  <error-code>500</error-code>
  <location>/a/b/c/500.jsp</location>
</error-page>

<error-page>
  <error-code>404</error-code>
  <location>/a/b/c/404.jsp</location> <!--表示的是http://localhost:8080/book/a/b/c/404.jsp-->
</error-page>
```
使用的前提是，自己写的业务代码不要trycatch异常，让异常抛给tomcat


* 使用ajax来发送去请求判断注册用户时，用户名是否可用，离开焦点后触发

* 购物车使用session来实现，没有购物车这个数据库表

* 页面实现国际化，中英文切换